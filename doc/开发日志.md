
20250904
第一阶段： 实现基础的单聊功能和WebSocket连接

技术选择
使用Netty进行websocket通讯

主要分为两种聊天模式：1、单聊模式；2、群聊模式 

先实现用户与用户之间的单独聊天模式功能，比如说：用户A向用户B进行聊天，然后用户B可以看到聊天发送过来的消息，然后进行回复，聊天可以发送图片，
发送emoji表情，正常文本信息，然后这个后端只提供接口，让前端自己在需要的地方调用

群聊模式：创建一个群聊会话，

CREATE TABLE chat_session (
id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
session_id VARCHAR(64) UNIQUE NOT NULL COMMENT '会话ID',
session_type TINYINT NOT NULL COMMENT '会话类型：1-单聊，2-群聊',
session_name VARCHAR(100) COMMENT '会话名称（群聊名称）',
session_avatar VARCHAR(255) COMMENT '会话头像',
creator_id BIGINT COMMENT '创建者ID',
max_members INT DEFAULT 500 COMMENT '最大成员数（群聊）',
status TINYINT DEFAULT 1 COMMENT '状态：0-禁用，1-启用',
create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
INDEX idx_session_type (session_type),
INDEX idx_creator (creator_id),
INDEX idx_create_time (create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='聊天会话表';

CREATE TABLE chat_session_member (
id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
session_id VARCHAR(64) NOT NULL COMMENT '会话ID',
user_id BIGINT NOT NULL COMMENT '用户ID',
user_nickname VARCHAR(50) COMMENT '用户昵称',
user_avatar VARCHAR(255) COMMENT '用户头像',
role TINYINT DEFAULT 0 COMMENT '角色：0-普通成员，1-管理员，2-群主',
join_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '加入时间',
last_read_time DATETIME COMMENT '最后阅读时间',
is_muted TINYINT DEFAULT 0 COMMENT '是否禁言：0-否，1-是',
status TINYINT DEFAULT 1 COMMENT '状态：0-已退出，1-正常',
UNIQUE KEY uk_session_user (session_id, user_id),
INDEX idx_user (user_id),
INDEX idx_session (session_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='会话成员表';

CREATE TABLE chat_message (
id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
message_id VARCHAR(64) UNIQUE NOT NULL COMMENT '消息ID',
session_id VARCHAR(64) NOT NULL COMMENT '会话ID',
from_user_id BIGINT NOT NULL COMMENT '发送者ID',
from_user_nickname VARCHAR(50) COMMENT '发送者昵称',
from_user_avatar VARCHAR(255) COMMENT '发送者头像',
message_type TINYINT NOT NULL COMMENT '消息类型：1-文本，2-图片，3-表情，4-文件，99-系统消息',
content TEXT COMMENT '消息内容',
extra_data JSON COMMENT '扩展数据（图片URL、文件信息等）',
reply_to_message_id VARCHAR(64) COMMENT '回复的消息ID',
status TINYINT DEFAULT 0 COMMENT '消息状态：0-正常，1-已撤回',
create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
INDEX idx_session (session_id),
INDEX idx_from_user (from_user_id),
INDEX idx_create_time (create_time),
INDEX idx_message_type (message_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='聊天消息表';

CREATE TABLE chat_message_read (
id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
message_id VARCHAR(64) NOT NULL COMMENT '消息ID',
session_id VARCHAR(64) NOT NULL COMMENT '会话ID',
user_id BIGINT NOT NULL COMMENT '用户ID',
read_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '阅读时间',
UNIQUE KEY uk_message_user (message_id, user_id),
INDEX idx_session_user (session_id, user_id),
INDEX idx_message (message_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='消息阅读状态表';

第二阶段：添加群聊、文件传输等功能

第三阶段：集成客服系统和小程序适配

第四阶段：性能优化